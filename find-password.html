<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>한국 환경협회</title>
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicons/favicon-16x16.png">
    <link rel="manifest" href="assets/images/favicons/site.webmanifest">

    <!-- Fonts-->

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/moonspam/NanumSquare@2.0/nanumsquare.css">
    <!-- Css-->
    <link rel="stylesheet" href="assets/css/animate.min.css">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css">
    <link rel="stylesheet" href="assets/css/owl.theme.default.min.css">
    <link rel="stylesheet" href="assets/css/magnific-popup.css">
    <link rel="stylesheet" href="assets/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="assets/css/swiper.min.css">
    <link rel="stylesheet" href="assets/css/bootstrap-select.min.css">

    <link rel="stylesheet" href="assets/css/jquery.mCustomScrollbar.min.css">
    <link rel="stylesheet" href="assets/css/bootstrap-datepicker.min.css">
    <link rel="stylesheet" href="assets/css/vegas.min.css">
    <link rel="stylesheet" href="assets/css/nouislider.min.css">
    <link rel="stylesheet" href="assets/css/nouislider.pips.css">
    <link rel="stylesheet" href="assets/css/jquery.bxslider.css">
    <link rel="stylesheet" href="assets/css/agrikol_iconl.css">
    <!-- Template styles -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/responsive.css">

</head>

<body>

<div class="preloader">
    <img src="assets/images/loader.png" class="preloader__image" alt="">
</div><!-- /.preloader -->

<div class="page-wrapper">


    <div class="site-header__header-one-wrap">

        <div class="topbar-one">
            <div class="topbar_bg" style="background-image: url(assets/images/shapes/header-bg.png)"></div>
            <div class="container">
                <div class="topbar-one__left">
                    <a href="tel:010-5850-8885"><span class="icon-phone-call"></span>010-5850-8885</a>
                    <a href="mailto:gislmh@naver.com"><span class="icon-message"></span>gislmh@naver.com</a>
                    <a ><span class="icon-clock"></span>9AM - 6PM</a>
                </div>

<!--                <div class="topbar-one__right">-->
<!--                    <div class="topbar-one__social">-->
<!--                        <a href="#"><i class="fab fa-facebook-square"></i></a>-->
<!--                        <a href="#"><i class="fab fa-twitter"></i></a>-->
<!--                        <a href="#"><i class="fab fa-youtube"></i></a>-->
<!--                        <a href="#"><i class="fab fa-instagram"></i></a>-->
<!--                    </div>-->
<!--                </div>-->
            </div>
        </div>

        <header class="main-nav__header-one">
            <nav class="header-navigation stricky">
                <div class="container clearfix">
                    <!-- Brand and toggle get grouped for better mobile display -->

                    <div class="main-nav__left">
                        <a href="index.html" class="main-nav__logo">
                            <img src="assets/images/resources/main-logo2.png" class="main-logo" alt="Awesome Image"/>
                        </a>

                    </div>
                    <div class="main-nav__main-navigation">
                        <ul class=" main-nav__navigation-box">
                            <li class="dropdown">
                                <a href="greeting.html">협회 소개</a>
                                <ul>
                                    <li><a href="greeting.html">인사말</a></li>
                                    <li><a href="license.html">설립허가 및 고유번호증</a></li>
                                    <li><a href="organization-chart.html">조직도</a></li>
                                    <li><a href="vision.html">협회비전</a></li>
                                    <li><a href="ci.html">협회 CI</a></li>

                                </ul><!-- /.sub-menu -->
                            </li>
                            <li class="dropdown">
                                <a href="environmental-program.html">협회 사업</a>
                                <ul>
                                    <li><a href="environmental-education.html">환경 교육 프로그램</a></li>
                                    <li><a href="environmental-program.html">환경 체험 프로그램</a></li>
                                    <li><a href="nature-restoration-project.html">풀빛 세상 만들기</a></li>
                                    <li><a href="csr-consulting.html">기업 사회 공헌 컨설팅</a></li>
                                </ul><!-- /.sub-menu -->
                            </li>
                            <li class="dropdown">
                                <a href="notice.html">커뮤니티</a>
                                <ul>
                                    <li><a href="notice.html">공지사항</a></li>
                                    <li><a href="free-board.html">자유게시판</a></li>
                                    <li><a href="gallery.html">사진갤러리</a></li>
                                </ul><!-- /.sub-menu -->
                            </li>
                            <li class="dropdown">
                                <a href="data-room.html">자료실</a>
                                <ul>
                                    <li><a href="data-room.html">협회 자료</a></li>
                                </ul><!-- /.sub-menu -->
                            </li>
                            <li class="dropdown">
                                <a href="donation.html">후원 안내</a>
                                <ul>
                                    <li><a href="donation.html">후원신청</a></li>
                                </ul><!-- /.sub-menu -->
                            </li>
                            <li class="dropdown current" id="loginMenu">
                                <a href="login.html">로그인</a>
                                <ul>
                                    <li><a href="sign-up.html">회원 가입</a></li>
                                </ul>
                            </li>

                        </ul>
                    </div><!-- /.navbar-collapse -->

                    <div class="main-nav__right">
                        <div class="main-nav__left1">
                            <a href="#" class="side-menu__toggler">
                                <i class="fa fa-bars"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </nav>
        </header>
    </div>

    <section class="page-header" style="background-image: url(assets/images/resources/image3.jpg);">
        <div class="container">
            <p>21세기 친환경 한국을 향한 꿈</p>
            <h2>협회 소개</h2>

        </div>
    </section>

    <section class="best_company">
        <div class="container">
            <h2 id="introduction">비밀번호 찾기</h2>
            <div class="find-password-section">
                <div class="password-box">
                    <h2>비밀번호 재설정</h2>
                    <form id="reset-password-form">
                        <div class="find-password-form-group">
                            <input type="text" id="name" placeholder="이름" required>
                        </div>
                        <div class="find-password-form-group">
                            <input type="text" id="phoneNumber" placeholder="전화번호" required>
                        </div>
                        <div class="find-password-form-group">
                            <input type="text" id="email" placeholder="이메일" required>
                        </div>
                        <div class="signup-form-group">
                            <input type="password" id="newPassword" placeholder="영문자,특수문자가 포함된 8~15자로 작성해주세요." required>
                        </div>
                        <div class="signup-form-group">
                            <input type="password" id="checkPassword" placeholder="비밀번호 확인" required>
                        </div>
                        <button type="submit" class="btn">비밀번호 재설정</button>
                        <div class="find-password-option">
                            <p><a id="find-email" href="find-email.html">아이디 찾기</a></p>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <div class="site-footer_bottom">
        <div class="container">
            <div class="site-footer_bottom_copyright">
                <p> <a href="donation.html">@ 한국 환경협회</a></p>
            </div>
            <div class="site-footer_bottom_copyright">
                <p> 고유번호 : 497-82-00350  </p>
            </div>
        </div>
    </div>


</div><!-- /.page-wrapper -->


<a href="#" data-target="html" class="scroll-to-target scroll-to-top"><i class="fa fa-angle-up"></i></a>

<div class="side-menu__block">
    <div class="side-menu__block-overlay custom-cursor__overlay">
        <div class="cursor"></div>
        <div class="cursor-follower"></div>
    </div><!-- /.side-menu__block-overlay -->
    <div class="side-menu__block-inner ">
        <div class="side-menu__top justify-content-end">
            <a href="#" class="side-menu__toggler side-menu__close-btn"><img
                    src="assets/images/shapes/close-1-1.png" alt=""></a>
        </div><!-- /.side-menu__top -->

        <nav class="mobile-nav__container">
            <!-- content is loading via js -->
        </nav>

        <div class="side-menu__sep"></div><!-- /.side-menu__sep -->

        <div class="side-menu__content">
            <p><a href="mailto:gislmh@naver.com">gislmh@naver.com</a> <br> <a href="tel:010-5850-8885">010-5850-8885</a></p>
            <!--            <div class="side-menu__social">-->
            <!--                <a href="#"><i class="fab fa-facebook-square"></i></a>-->
            <!--                <a href="#"><i class="fab fa-twitter"></i></a>-->
            <!--                <a href="#"><i class="fab fa-instagram"></i></a>-->
            <!--                <a href="#"><i class="fab fa-pinterest-p"></i></a>-->
            <!--            </div>-->
        </div>
    </div>
</div>


<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/bootstrap.bundle.min.js"></script>
<script src="assets/js/owl.carousel.min.js"></script>
<script src="assets/js/waypoints.min.js"></script>
<script src="assets/js/jquery.counterup.min.js"></script>
<script src="assets/js/TweenMax.min.js"></script>
<script src="assets/js/wow.js"></script>
<script src="assets/js/jquery.magnific-popup.min.js"></script>
<script src="assets/js/jquery.ajaxchimp.min.js"></script>
<script src="assets/js/swiper.min.js"></script>
<script src="assets/js/typed-2.0.11.js"></script>
<script src="assets/js/vegas.min.js"></script>
<script src="assets/js/jquery.validate.min.js"></script>
<script src="assets/js/bootstrap-select.min.js"></script>
<script src="assets/js/countdown.min.js"></script>
<script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/js/bootstrap-datepicker.min.js"></script>
<script src="assets/js/nouislider.min.js"></script>
<script src="assets/js/isotope.js"></script>
<script src="assets/js/jquery.bxslider.min.js"></script>
<script src="assets/js/appear.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<!-- template scripts -->
<script src="assets/js/theme.js"></script>
<script src="assets/js/tokenManager.js"></script>
<script src="assets/js/logoutHandler.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const resetPasswordForm = document.getElementById('reset-password-form');
        const resultMessageDiv = document.getElementById('result-message');

        resetPasswordForm.addEventListener('submit', function (e) {
            e.preventDefault();

            // 입력된 값들 가져오기
            const name = document.getElementById('name').value.trim();
            const phoneNumber = document.getElementById('phoneNumber').value.trim();
            const email = document.getElementById('email').value.trim();
            const newPassword = document.getElementById('newPassword').value.trim();
            const checkPassword = document.getElementById('checkPassword').value.trim();

            // 유효성 검사
            if (!name || !phoneNumber || !email || !newPassword || !checkPassword) {
                swal({
                    title: "경고!",
                    text: "모든 필드를 입력하세요." ,
                    icon: "warning",
                    buttons: {
                            confirm: {
                                text: "확인",
                                value: true,
                                visible: true,
                                className: "custom-confirm-btn",
                                closeModal: true
                            }
                        }
                });
                return;
            }

            // 회원 검증 요청 데이터 생성
            const checkMemberData = {
                name: name,
                phoneNumber: phoneNumber,
                email: email
            };

            // 회원인지 검증하는 API 호출
            fetch('http://49.247.174.32:8080/auth/find/member', {
            // fetch('http://localhost:8080/auth/find/member', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(checkMemberData)
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 200) {
                        // 회원 검증 성공 시 비밀번호 재설정 로직 실행
                        resetPassword(name, phoneNumber, email, newPassword, checkPassword);
                    } else {
                        swal({
                            title: "실패!",
                            text: "회원이 아닙니다! 회원가입을 먼저 진행해주세요!." ,
                            icon: "error",
                            buttons: {
                            confirm: {
                                text: "확인",
                                value: true,
                                visible: true,
                                className: "custom-confirm-btn",
                                closeModal: true
                            }
                        }
                        });
                    }
                })
                .catch(error => {
                    swal({
                        title: "실패!",
                        text: "회원 검증 중 오류가 발생했습니다 :" +error.message ,
                        icon: "error",
                        buttons: {
                            confirm: {
                                text: "확인",
                                value: true,
                                visible: true,
                                className: "custom-confirm-btn",
                                closeModal: true
                            }
                        }
                    });
                });
        });

        // 비밀번호 재설정 함수
        function resetPassword(name, phoneNumber, email, newPassword, checkPassword) {
            // 비밀번호 재설정 요청 데이터 생성
            const resetPasswordData = {
                phoneNumber: phoneNumber,
                name: name,
                email: email,
                password: newPassword,
                confirmPassword : checkPassword
            };

            // 비밀번호 재설정 API 호출
            fetch('http://49.247.174.32:8080/auth/reset/password', {
            // fetch('http://localhost:8080/auth/reset/password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(resetPasswordData)
            })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    return response.json().then(errorData => {
                        swal({
                            title: "실패!",
                            text: "에러가 발생했습니다!." +  errorData.message ,
                            icon: "error",
                            buttons: {
                            confirm: {
                                text: "확인",
                                value: true,
                                visible: true,
                                className: "custom-confirm-btn",
                                closeModal: true
                            }
                        }
                        });
                    });
                })

                .then(data => {
                    if (data.status === 200) {
                        swal({
                            title: "성공!",
                            text: "비밀번호를 성공적으로 변경했습니다!." ,
                            icon: "success",
                            buttons: {
                            confirm: {
                                text: "확인",
                                value: true,
                                visible: true,
                                className: "custom-confirm-btn",
                                closeModal: true
                            }
                        }
                        }).then(() =>{
                            window.location.href = 'login.html';
                        });
                    } else {
                        swal({
                            title: "실패!",
                            text: "비밀번호 변경에 실패했습니다 다시 시도해주세요!." ,
                            icon: "error",
                            buttons: {
                            confirm: {
                                text: "확인",
                                value: true,
                                visible: true,
                                className: "custom-confirm-btn",
                                closeModal: true
                            }
                        }
                        });
                    }
                })
                .catch(error => {
                    swal({
                        title: "실패!",
                        text: "비밀번호 재설정 중 오류가 발생했습니다!."+  error.message ,
                        icon: "error",
                        buttons: {
                            confirm: {
                                text: "확인",
                                value: true,
                                visible: true,
                                className: "custom-confirm-btn",
                                closeModal: true
                            }
                        }
                    });
                });
        }
    });

</script>
</body>

</html>